<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¸©åœ°é›·</title>
    <style>
        :root {
            /* Define a variable for cell size, will be updated by JS */
            --cell-size: 40px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            background-color: #dcdcdc;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 15px;
            width: 100vw;
            min-height: 100vh; /* Allow the page to grow and scroll vertically */
            box-sizing: border-box;
        }

        #game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 95vw;
            margin-bottom: 10px;
        }

        #timer {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            background-color: #fff;
            padding: 8px 15px;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        #difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .difficulty-btn {
            padding: 10px 15px;
            font-size: 1rem;
            border: 2px solid #ccc;
            border-radius: 8px;
            background-color: #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .difficulty-btn.active {
            background-color: #a5d6a7;
            border-color: #388e3c;
            font-weight: bold;
        }

        #grid-container {
            display: grid;
            grid-template-columns: repeat(var(--grid-cols, 8), var(--cell-size));
            grid-template-rows: repeat(var(--grid-rows, 8), var(--cell-size));
            width: fit-content; /* Grid width adjusts to its content */
            margin: 20px auto; /* Center the grid */
            overflow-x: auto; /* Enable horizontal scrolling on mobile */
            background-color: #bdbdbd;
            border: 3px solid #7b7b7b;
            padding: 5px; /* Add some padding around the cells */
            gap: 2px;
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            box-sizing: border-box;
            border: 1px solid #a9a9a9;
            background-color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: calc(var(--cell-size) * 0.6);
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }

        .cell.revealed { background-color: #fff; }
        .cell.revealed.c1 { color: blue; }
        .cell.revealed.c2 { color: green; }
        .cell.revealed.c3 { color: red; }
        .cell.revealed.c4 { color: darkblue; }
        .cell.revealed.c5 { color: brown; }
        .cell.revealed.c6 { color: cyan; }
        .cell.revealed.c7 { color: black; }
        .cell.revealed.c8 { color: grey; }

        #mode-toggle-container {
            display: flex;
            gap: 15px;
            margin: 10px 0;
        }

        .mode-btn {
            padding: 12px 20px;
            font-size: 1.5rem;
            border: 2px solid #888;
            border-radius: 8px;
            background-color: #f0f0f0;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .mode-btn.active {
            background-color: #a5d6a7;
            border-color: #388e3c;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        #restart-btn {
             margin-top: 10px;
             padding: 12px 20px;
             font-size: 1.2rem;
             border: 2px solid #888;
             border-radius: 8px;
             background-color: #f0f0f0;
             cursor: pointer;
        }

        #energy-slot {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            margin-bottom: 20px; /* Added space below the lights */
        }

        .light {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: #7f8c8d;
            transition: background-color 0.3s, box-shadow 0.3s;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.4);
        }

        .light.on {
            background-color: #2ecc71;
            box-shadow: 0 0 10px #2ecc71, 0 0 20px #2ecc71;
        }

        #computer-assistant, #instructions {
            max-width: 90vw;
            margin-top: 15px;
            text-align: left;
            padding: 0 15px;
            color: #333;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="game-header">
        <h1>è¸©åœ°é›·</h1>
        <div id="timer">0s</div>
    </div>
    
    <div id="difficulty-selector">
        <button id="easy-btn" class="difficulty-btn active">åˆç´š</button>
        <button id="medium-btn" class="difficulty-btn">ä¸­ç´š</button>
        <button id="hard-btn" class="difficulty-btn">é«˜ç´š</button>
    </div>

    <div id="mode-toggle-container">
        <button id="dig-mode-btn" class="mode-btn active">â›ï¸ æŒ–é–‹</button>
        <button id="flag-mode-btn" class="mode-btn">ğŸš© æ’æ——</button>
    </div>
    
    <div id="grid-container"></div>
    
    <div id="energy-slot">
        <div class="light"></div>
        <div class="light"></div>
        <div class="light"></div>
    </div>
    <div id="computer-assistant"></div>

    <button id="restart-btn">é‡æ–°é–‹å§‹</button>

    <div id="instructions">
        <h2>éŠæˆ²èªªæ˜</h2>
        <p><strong>ç›®æ¨™ï¼š</strong>æ‰¾å‡ºæ‰€æœ‰ä¸æ˜¯åœ°é›·çš„æ–¹å¡Šï¼Œä¸è¦å¼•çˆ†ä»»ä½•åœ°é›·ã€‚</p>
        <p><strong>ç©æ³•ï¼š</strong></p>
        <ul>
            <li><strong>é›»è…¦ï¼š</strong>å·¦éµé»æ“ŠæŒ–é–‹ï¼Œå³éµé»æ“Šæ’æ——(ğŸš©)ã€‚</li>
            <li><strong>æ‰‹æ©Ÿï¼š</strong>ä½¿ç”¨ä¸Šæ–¹çš„ â›ï¸/ğŸš© æŒ‰éˆ•åˆ‡æ›æ¨¡å¼ã€‚åœ¨ã€ŒæŒ–é–‹ã€æ¨¡å¼ä¸‹é»æ“Šç‚ºæŒ–é–‹ï¼›åœ¨ã€Œæ’æ——ã€æ¨¡å¼ä¸‹é»æ“Šç‚ºæ’æ——ã€‚</li>
        </ul>
        <p><strong>åœ°é›·æ•¸é‡ï¼š</strong></p>
        <ul>
            <li><strong>åˆç´š (8x8)ï¼š</strong> 10 é¡†åœ°é›·</li>
            <li><strong>ä¸­ç´š (12x12)ï¼š</strong> 20 é¡†åœ°é›·</li>
            <li><strong>é«˜ç´š (15x15)ï¼š</strong> 40 é¡†åœ°é›·</li>
        </ul>
        <p><strong>ç¶ ç‡ˆçå‹µï¼š</strong>æ¯ç•¶ä½ æ­£ç¢ºåœ°æ’ä¸Š1å€‹æ——å­(äº®èµ·1å€‹ç¶ ç‡ˆ)ï¼Œé›†æ»¿3å€‹ç¶ ç‡ˆï¼Œé›»è…¦å°‡æœƒè‡ªå‹•å¹«ä½ æ¨™ç¤ºä¸€å€‹åœ°é›·(ğŸ“)ã€‚</p>
    </div>
</div>

<script>
    const gridContainer = document.getElementById('grid-container');
    const timerDisplay = document.querySelector('#timer');
    const lights = document.querySelectorAll('.light');
    const computerAssistant = document.getElementById('computer-assistant');

    const difficultyLevels = {
        easy: { rows: 8, cols: 8, mines: 10, cellSize: 40 },
        medium: { rows: 12, cols: 12, mines: 20, cellSize: 30 },
        hard: { rows: 15, cols: 15, mines: 40, cellSize: 25 }
    };
    let currentDifficulty = 'easy';
    
    let grid = [];
    let gameOver = false;
    let isFirstClick = true;
    let currentMode = 'dig';
    let correctFlagsCount = 0;

    let timerInterval = null;
    let seconds = 0;

    function startTimer() {
        if (isFirstClick) {
            isFirstClick = false;
            timerInterval = setInterval(() => {
                seconds++;
                timerDisplay.textContent = seconds + 's';
            }, 1000);
        }
    }

    function stopTimer() {
        clearInterval(timerInterval);
        timerInterval = null;
    }

    function resetTimer() {
        stopTimer();
        seconds = 0;
        isFirstClick = true;
        timerDisplay.textContent = '0s';
    }

    function updateLights() {
        lights.forEach((light, index) => {
            light.classList.toggle('on', index < correctFlagsCount);
        });
    }

    function computerRevealMine() {
        const { rows, cols } = difficultyLevels[currentDifficulty];
        let unrevealedMines = [];
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (grid[r][c].isMine && !grid[r][c].isFlagged && !grid[r][c].isComputerFlagged) {
                    unrevealedMines.push({r, c});
                }
            }
        }

        if (unrevealedMines.length > 0) {
            const randomMine = unrevealedMines[Math.floor(Math.random() * unrevealedMines.length)];
            grid[randomMine.r][randomMine.c].isComputerFlagged = true;
            computerAssistant.textContent = `åµæ¸¬åˆ°åœ°é›·ä¿¡è™Ÿï¼Œå·²åœ¨ (${randomMine.r}, ${randomMine.c}) æ¨™ç¤ºä¸€å€‹åœ°é›·ã€‚`;
            renderGrid();
        }
    }

    function initGame(difficulty) {
        currentDifficulty = difficulty;
        const { rows, cols, mines, cellSize } = difficultyLevels[difficulty];
        
        gameOver = false;
        correctFlagsCount = 0;
        grid = [];
        
        resetTimer();
        updateLights();
        setMode('dig');
        computerAssistant.textContent = '';

        document.documentElement.style.setProperty('--cell-size', `${cellSize}px`);
        gridContainer.style.setProperty('--grid-rows', rows);
        gridContainer.style.setProperty('--grid-cols', cols);

        document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`${difficulty}-btn`).classList.add('active');
        
        for (let i = 0; i < rows; i++) {
            grid[i] = [];
            for (let j = 0; j < cols; j++) {
                grid[i][j] = {
                    isMine: false,
                    isRevealed: false,
                    isFlagged: false,
                    isComputerFlagged: false,
                    adjacentMines: 0
                };
            }
        }

        let minesPlaced = 0;
        while (minesPlaced < mines) {
            const r = Math.floor(Math.random() * rows);
            const c = Math.floor(Math.random() * cols);
            if (!grid[r][c].isMine) {
                grid[r][c].isMine = true;
                minesPlaced++;
            }
        }

        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (grid[r][c].isMine) continue;
                let count = 0;
                for (let dr = -1; dr <= 1; dr++) {
                    for (let dc = -1; dc <= 1; dc++) {
                        const nr = r + dr;
                        const nc = c + dc;
                        if (nr >= 0 && nr < rows && nc >= 0 && nc < cols && grid[nr][nc].isMine) {
                            count++;
                        }
                    }
                }
                grid[r][c].adjacentMines = count;
            }
        }
        
        createGridDOM(rows, cols);
        renderGrid();
    }
    
    function createGridDOM(rows, cols) {
        gridContainer.innerHTML = '';
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                const div = document.createElement('div');
                div.classList.add('cell');
                div.dataset.r = r;
                div.dataset.c = c;
                div.addEventListener('click', () => handleCellClick(r, c));
                div.addEventListener('contextmenu', (e) => {
                    e.preventDefault();
                    handleRightClick(r, c);
                });
                gridContainer.appendChild(div);
            }
        }
    }

    function renderGrid() {
        const { rows, cols } = difficultyLevels[currentDifficulty];
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                const cellIndex = r * cols + c;
                if(cellIndex >= gridContainer.children.length) continue;
                const cell = gridContainer.children[cellIndex];
                const cellData = grid[r][c];

                cell.innerHTML = '';
                cell.className = 'cell';

                if (cellData.isRevealed) {
                    cell.classList.add('revealed');
                    if (cellData.isMine) {
                        cell.innerHTML = 'ğŸ’£';
                    } else if (cellData.adjacentMines > 0) {
                        cell.innerHTML = cellData.adjacentMines;
                        cell.classList.add(`c${cellData.adjacentMines}`);
                    }
                } else {
                     if (gameOver && cellData.isFlagged && !cellData.isMine) {
                        cell.innerHTML = 'âŒ';
                    } else if (cellData.isComputerFlagged) {
                        cell.innerHTML = 'ğŸ“';
                    } else if (cellData.isFlagged) {
                        cell.innerHTML = 'ğŸš©';
                    }
                }
            }
        }
    }

    function handleCellClick(r, c) {
        if (gameOver || grid[r][c].isComputerFlagged || grid[r][c].isRevealed) return;
        
        startTimer();

        if (currentMode === 'dig') {
            if (grid[r][c].isFlagged) return;

            if (grid[r][c].isMine) {
                gameOver = true;
                stopTimer();
                revealAllMines();
                setTimeout(() => alert('éŠæˆ²çµæŸï¼ä½ è¸©åˆ°åœ°é›·äº†ã€‚'), 100);
            } else {
                revealCell(r, c);
                checkWin();
            }
        } else { 
             handleRightClick(r, c);
        }
        renderGrid();
    }
    
    function revealCell(r, c) {
        const { rows, cols } = difficultyLevels[currentDifficulty];
        if (r < 0 || r >= rows || c < 0 || c >= cols || grid[r][c].isRevealed || grid[r][c].isFlagged || grid[r][c].isComputerFlagged) {
            return;
        }

        grid[r][c].isRevealed = true;

        if (grid[r][c].adjacentMines === 0) {
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    revealCell(r + dr, c + dc);
                }
            }
        }
    }

    function handleRightClick(r, c) {
        if (gameOver || grid[r][c].isRevealed || grid[r][c].isComputerFlagged) {
            return;
        }

        grid[r][c].isFlagged = !grid[r][c].isFlagged;

        if (grid[r][c].isMine) {
             if(grid[r][c].isFlagged) {
                correctFlagsCount++;
             } else {
                correctFlagsCount--;
             }
        } 

        updateLights();

        if (correctFlagsCount === 3) {
            computerRevealMine();
            correctFlagsCount = 0;
            setTimeout(updateLights, 600); 
        }

        renderGrid();
        checkWin();
    }
    
    function revealAllMines() {
        const { rows, cols } = difficultyLevels[currentDifficulty];
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (grid[r][c].isMine) {
                    grid[r][c].isRevealed = true;
                }
            }
        }
        renderGrid();
    }

    function checkWin() {
        const { rows, cols, mines } = difficultyLevels[currentDifficulty];
        let revealedCount = 0;
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (grid[r][c].isRevealed) {
                    revealedCount++;
                }
            }
        }

        if (revealedCount === rows * cols - mines) {
            gameOver = true;
            stopTimer();
            setTimeout(() => alert(`æ­å–œï¼ä½ è´äº†ï¼è€—æ™‚ ${seconds} ç§’ã€‚`), 100);
            revealAllMines();
        }
    }
    
    function setMode(newMode) {
        currentMode = newMode;
        document.getElementById('dig-mode-btn').classList.toggle('active', newMode === 'dig');
        document.getElementById('flag-mode-btn').classList.toggle('active', newMode === 'flag');
    }

    document.getElementById('dig-mode-btn').addEventListener('click', () => setMode('dig'));
    document.getElementById('flag-mode-btn').addEventListener('click', () => setMode('flag'));
    document.getElementById('easy-btn').addEventListener('click', () => initGame('easy'));
    document.getElementById('medium-btn').addEventListener('click', () => initGame('medium'));
    document.getElementById('hard-btn').addEventListener('click', () => initGame('hard'));
    document.getElementById('restart-btn').addEventListener('click', () => initGame(currentDifficulty));

    window.onload = () => initGame('easy');
</script>

</body>
</html>
